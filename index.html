<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Ocean Explorer - Ger√ßek√ßi Okyanus</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            background: #000;
        }

        #startScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #000428, #004e92);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            color: white;
            text-align: center;
        }

        .title {
            font-size: 3.5rem;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #00b4db, #0083b0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(0, 180, 219, 0.5);
        }

        .subtitle {
            font-size: 1.2rem;
            margin-bottom: 40px;
            color: #a8e6cf;
            max-width: 600px;
        }

        .start-button {
            padding: 18px 45px;
            font-size: 1.4rem;
            background: linear-gradient(45deg, #00b4db, #0083b0);
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            margin: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 10px 30px rgba(0, 180, 219, 0.4);
        }

        .start-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 180, 219, 0.6);
        }

        #gameScreen {
            display: none;
            width: 100%;
            height: 100vh;
        }

        #ui {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 10;
            color: white;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .fish-selector {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 10;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .fish-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 3px solid transparent;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            overflow: hidden;
        }

        .fish-btn img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .fish-btn:hover {
            transform: scale(1.15);
            border-color: #00b4db;
            box-shadow: 0 0 20px rgba(0, 180, 219, 0.8);
        }

        .fish-btn.active {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.2);
            box-shadow: 0 0 25px #00ff88;
            transform: scale(1.1);
        }

        #controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 10;
            color: white;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-info {
            margin: 5px 0;
            font-size: 0.9rem;
            color: #a8e6cf;
        }

        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            font-size: 1.5rem;
        }

        .load-bar {
            width: 300px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            margin-top: 20px;
            border-radius: 2px;
            overflow: hidden;
        }

        .load-progress {
            height: 100%;
            background: linear-gradient(90deg, #00b4db, #0083b0);
            width: 0%;
            transition: width 0.3s;
        }

        canvas {
            display: block;
        }

        #depth {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10;
            color: white;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .fish-name-tag {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            pointer-events: none;
            white-space: nowrap;
            display: none;
            z-index: 5;
        }
    </style>
</head>
<body>
    <!-- Y√úKLEME EKRANI -->
    <div id="loading">
        <div style="text-align: center;">
            <div style="font-size: 3rem; margin-bottom: 20px; animation: float 2s infinite;">üåä</div>
            <div>Ger√ßek√ßi Okyanus Y√ºkleniyor...</div>
            <div id="loadText" style="margin-top: 10px; color: #00b4db;">Assets hazƒ±rlanƒ±yor...</div>
            <div class="load-bar">
                <div class="load-progress" id="loadProgress"></div>
            </div>
        </div>
    </div>

    <!-- BA≈ûLANGI√á EKRANI -->
    <div id="startScreen">
        <h1 class="title">üåä 3D REALISTIC OCEAN</h1>
        <p class="subtitle">Foto-realistik okyanus d√ºnyasƒ±nƒ± ke≈üfet! Ger√ßek balƒ±k modelleri ve profesyonel su efekti ile unutulmaz bir dalƒ±≈ü deneyimi.</p>
        <button class="start-button" id="startButton">DERƒ∞NLƒ∞KLERE DAL</button>
        <div style="margin-top: 30px; color: #66fcf1; font-size: 0.9rem;">
            <p>üéÆ Kontroller: Tƒ±klayarak balƒ±ƒüƒ± y√∂nlendir | Fare ile kamera kontrol√º | Balƒ±k deƒüi≈ütirmek i√ßin alttaki fotoƒüraflarƒ± kullan</p>
        </div>
    </div>

    <!-- OYUN EKRANI -->
    <div id="gameScreen">
        <div id="ui">
            <h2 style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 1.5rem;">üê†</span>
                <span>Okyanus Ke≈üif Modu</span>
            </h2>
            <div style="margin-top: 10px;">
                <div id="fishInfo">Se√ßili: <span id="currentFish" style="color: #00ff88; font-weight: bold;">Yunus</span></div>
                <div id="positionInfo" style="font-size: 0.9rem; color: #a8e6cf;">Derinlik: <span id="currentDepth">5m</span></div>
            </div>
        </div>

        <div id="depth">
            <div style="display: flex; align-items: center; gap: 8px;">
                <span style="font-size: 1.2rem;">üìè</span>
                <span>Derinlik: <span id="depthValue" style="color: #00b4db; font-weight: bold;">5m</span></span>
            </div>
        </div>

        <div class="fish-selector" id="fishSelector">
            <!-- Balƒ±k butonlarƒ± JavaScript ile eklenecek -->
        </div>

        <div id="controls">
            <h3 style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
                <span>üéÆ</span>
                <span>Kontroller</span>
            </h3>
            <div class="control-info">‚Ä¢ Tƒ±klama: Balƒ±ƒüƒ± hareket ettir</div>
            <div class="control-info">‚Ä¢ Fare s√ºr√ºkle: Kamera d√∂nd√ºr</div>
            <div class="control-info">‚Ä¢ Fare tekerleƒüi: Zoom yap</div>
            <div class="control-info">‚Ä¢ W/A/S/D: Kamera hareketi</div>
            <button onclick="backToMenu()" style="margin-top: 15px; padding: 8px 15px; background: linear-gradient(45deg, #ff6b6b, #ff4757); border: none; border-radius: 8px; color: white; cursor: pointer; width: 100%;">Men√ºye D√∂n</button>
        </div>
        
        <div id="fishNameTag" class="fish-name-tag"></div>
    </div>

    <!-- Three.js Script -->
    <script type="module">
        import * as THREE from 'https://esm.run/three';
        import { OrbitControls } from 'https://esm.run/three/examples/jsm/controls/OrbitControls.js';
        import { Water } from 'https://esm.run/three/examples/jsm/objects/Water.js';
        import { Sky } from 'https://esm.run/three/examples/jsm/objects/Sky.js';

        console.log("üåä GER√áEK√áƒ∞ OKYANUS Y√úKLENƒ∞YOR...");

        // DOM ELEMENTLERƒ∞
        const loadingScreen = document.getElementById('loading');
        const startScreen = document.getElementById('startScreen');
        const gameScreen = document.getElementById('gameScreen');
        const startButton = document.getElementById('startButton');
        const loadProgress = document.getElementById('loadProgress');
        const loadText = document.getElementById('loadText');
        const currentFish = document.getElementById('currentFish');
        const currentDepth = document.getElementById('currentDepth');
        const depthValue = document.getElementById('depthValue');
        const fishSelector = document.getElementById('fishSelector');
        const fishNameTag = document.getElementById('fishNameTag');

        // GER√áEK BALIK G√ñRSELLERƒ∞ (Public Domain/Free to use images)
        const FISH_TEXTURES = [
            { 
                name: 'Yunus', 
                url: 'https://images.unsplash.com/photo-1570481662006-a3a1374699f8?w=400&h=400&fit=crop&crop=face',
                scale: 0.8,
                speed: 2.5
            },
            { 
                name: 'K√∂pekbalƒ±ƒüƒ±', 
                url: 'https://images.unsplash.com/photo-1560279966-8ff2f6c7a2d1?w=400&h=400&fit=crop&crop=face',
                scale: 1.0,
                speed: 3.0
            },
            { 
                name: 'Palya√ßo Balƒ±ƒüƒ±', 
                url: 'https://images.unsplash.com/photo-1559718062-3611547c7249?w=400&h=400&fit=crop',
                scale: 0.4,
                speed: 1.8
            },
            { 
                name: 'Vatoz', 
                url: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=400&fit=crop',
                scale: 0.7,
                speed: 1.5
            },
            { 
                name: 'Melek Balƒ±ƒüƒ±', 
                url: 'https://images.unsplash.com/photo-1524704654690-b56c05c78a00?w=400&h=400&fit=crop',
                scale: 0.5,
                speed: 1.6
            },
            { 
                name: 'Aslan Balƒ±ƒüƒ±', 
                url: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=300&fit=crop',
                scale: 0.6,
                speed: 1.7
            },
            { 
                name: 'M√ºren Balƒ±ƒüƒ±', 
                url: 'https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=400&h=400&fit=crop',
                scale: 0.9,
                speed: 1.4
            },
            { 
                name: 'Tang Balƒ±ƒüƒ±', 
                url: 'https://images.unsplash.com/photo-1559827291-72ee739d0d9a?w=400&h=400&fit=crop',
                scale: 0.5,
                speed: 2.0
            },
            { 
                name: '√áeki√ß Kafa K√∂pekbalƒ±ƒüƒ±', 
                url: 'https://images.unsplash.com/photo-1560279966-8ff2f6c7a2d1?w=400&h=300&fit=crop',
                scale: 1.1,
                speed: 2.8
            },
            { 
                name: 'Orkinos', 
                url: 'https://images.unsplash.com/photo-1535591273668-578e31182c4f?w=400&h=400&fit=crop',
                scale: 0.9,
                speed: 3.2
            }
        ];

        // THREE.JS AYARLARI
        let scene, camera, renderer, controls, water, sky, sun;
        let fishGroup, coralGroup, seaweedGroup, rockGroup, particleGroup;
        let playerFish = null;
        let selectedFishIndex = 0;
        let mouse = new THREE.Vector2();
        let raycaster = new THREE.Raycaster();
        let targetPosition = new THREE.Vector3(0, 0, 0);
        let isMoving = false;
        let clock = new THREE.Clock();
        let waterUniforms;
        let fishTextures = [];
        let assetsLoaded = 0;
        let totalAssets = FISH_TEXTURES.length + 10; // Balƒ±k + diƒüer assetler

        // Y√úKLEME ƒ∞LERLEMESƒ∞
        function updateLoadProgress(text, percent) {
            loadText.textContent = text;
            loadProgress.style.width = `${percent}%`;
        }

        // BALIK SE√áƒ∞Cƒ∞ BUTONLARI OLU≈ûTUR
        async function createFishButtons() {
            updateLoadProgress("Balƒ±k g√∂rselleri y√ºkleniyor...", 10);
            
            for (let i = 0; i < FISH_TEXTURES.length; i++) {
                const fish = FISH_TEXTURES[i];
                
                try {
                    // Balƒ±k g√∂rselini y√ºkle
                    const img = new Image();
                    img.crossOrigin = "anonymous";
                    
                    await new Promise((resolve, reject) => {
                        img.onload = () => {
                            const button = document.createElement('div');
                            button.className = 'fish-btn';
                            if (i === 0) button.classList.add('active');
                            button.title = fish.name;
                            
                            button.innerHTML = `<img src="${fish.url}" alt="${fish.name}" loading="lazy">`;
                            
                            button.addEventListener('click', () => {
                                selectFish(i);
                            });
                            
                            fishSelector.appendChild(button);
                            
                            assetsLoaded++;
                            const percent = Math.min(95, (assetsLoaded / totalAssets) * 100);
                            updateLoadProgress(`${fish.name} y√ºklendi...`, percent);
                            resolve();
                        };
                        
                        img.onerror = () => {
                            console.warn(`${fish.name} g√∂rseli y√ºklenemedi, fallback kullanƒ±lƒ±yor.`);
                            // Fallback buton
                            const button = document.createElement('div');
                            button.className = 'fish-btn';
                            if (i === 0) button.classList.add('active');
                            button.title = fish.name;
                            button.innerHTML = `üê†`;
                            
                            button.addEventListener('click', () => {
                                selectFish(i);
                            });
                            
                            fishSelector.appendChild(button);
                            resolve();
                        };
                        
                        img.src = fish.url;
                    });
                    
                } catch (error) {
                    console.error(`Balƒ±k ${i} y√ºkleme hatasƒ±:`, error);
                }
            }
        }

        // BALIK SE√á
        function selectFish(index) {
            selectedFishIndex = index;
            const fish = FISH_TEXTURES[index];
            
            // Buton aktifliƒüini g√ºncelle
            document.querySelectorAll('.fish-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
            
            // UI'ƒ± g√ºncelle
            currentFish.textContent = fish.name;
            
            // Oyuncu balƒ±ƒüƒ±nƒ± g√ºncelle
            if (playerFish && fishTextures[index]) {
                playerFish.material.map = fishTextures[index];
                playerFish.material.needsUpdate = true;
                playerFish.userData.speed = fish.speed;
                playerFish.scale.setScalar(fish.scale);
            }
        }

        // THREE.JS SAHNESƒ∞Nƒ∞ OLU≈ûTUR
        async function initThreeJS() {
            updateLoadProgress("3D sahne olu≈üturuluyor...", 20);
            
            // SAHNE
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000044, 0.01);
            
            // KAMERA
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
            camera.position.set(0, 10, 30);
            
            // RENDERER
            renderer = new THREE.WebGLRenderer({ 
                antialias: true,
                alpha: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000022);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 0.8;
            gameScreen.appendChild(renderer.domElement);
            
            // KONTROLLER
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.maxPolarAngle = Math.PI / 2;
            controls.minDistance = 5;
            controls.maxDistance = 100;
            controls.enablePan = false;
            
            updateLoadProgress("I≈üƒ±klandƒ±rma ekleniyor...", 30);
            
            // G√ñKY√úZ√ú VE G√úNE≈û
            sky = new Sky();
            sky.scale.setScalar(1000);
            scene.add(sky);

            sun = new THREE.Vector3();
            const skyUniforms = sky.material.uniforms;
            skyUniforms['turbidity'].value = 10;
            skyUniforms['rayleigh'].value = 2;
            skyUniforms['mieCoefficient'].value = 0.005;
            skyUniforms['mieDirectionalG'].value = 0.8;
            
            const phi = THREE.MathUtils.degToRad(90);
            const theta = THREE.MathUtils.degToRad(180);
            sun.setFromSphericalCoords(1, phi, theta);
            skyUniforms['sunPosition'].value.copy(sun);
            
            // I≈ûIKLAR
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.copy(sun);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            directionalLight.shadow.camera.near = 0.5;
            directionalLight.shadow.camera.far = 500;
            directionalLight.shadow.camera.left = -100;
            directionalLight.shadow.camera.right = 100;
            directionalLight.shadow.camera.top = 100;
            directionalLight.shadow.camera.bottom = -100;
            scene.add(directionalLight);

            const underwaterLight = new THREE.PointLight(0x0066ff, 0.5, 100);
            underwaterLight.position.set(0, 20, 0);
            scene.add(underwaterLight);
            
            updateLoadProgress("Su y√ºzeyi olu≈üturuluyor...", 40);
            
            // SU Y√úZEYƒ∞
            const waterGeometry = new THREE.PlaneGeometry(1000, 1000);
            water = new Water(waterGeometry, {
                textureWidth: 512,
                textureHeight: 512,
                waterNormals: new THREE.TextureLoader().load('https://threejs.org/examples/textures/waternormals.jpg', function(texture) {
                    texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
                }),
                sunDirection: new THREE.Vector3(),
                sunColor: 0xffffff,
                waterColor: 0x001e0f,
                distortionScale: 3.7,
                fog: scene.fog !== undefined
            });
            water.rotation.x = -Math.PI / 2;
            water.position.y = 25; // Su y√ºzeyi y√ºksekliƒüi
            scene.add(water);
            waterUniforms = water.material.uniforms;
            waterUniforms['size'].value = 10;
            
            updateLoadProgress("Okyanus zemini hazƒ±rlanƒ±yor...", 50);
            
            // OKYANUS ZEMƒ∞Nƒ∞
            const oceanFloorGeometry = new THREE.PlaneGeometry(1000, 1000, 100, 100);
            const oceanFloorMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x004466,
                side: THREE.DoubleSide
            });
            const oceanFloor = new THREE.Mesh(oceanFloorGeometry, oceanFloorMaterial);
            oceanFloor.rotation.x = -Math.PI / 2;
            oceanFloor.position.y = -50;
            oceanFloor.receiveShadow = true;
            scene.add(oceanFloor);
            
            // ZEMƒ∞N DETAYLARI
            const sandGeometry = new THREE.PlaneGeometry(1000, 1000, 200, 200);
            const sandMaterial = new THREE.MeshLambertMaterial({ 
                color: 0xc2b280,
                transparent: true,
                opacity: 0.7
            });
            const sand = new THREE.Mesh(sandGeometry, sandMaterial);
            sand.rotation.x = -Math.PI / 2;
            sand.position.y = -49.5;
            sand.receiveShadow = true;
            scene.add(sand);
            
            updateLoadProgress("Deniz canlƒ±larƒ± y√ºkleniyor...", 60);
            
            // DENƒ∞Z CANLILARI GRUPLARI
            fishGroup = new THREE.Group();
            coralGroup = new THREE.Group();
            seaweedGroup = new THREE.Group();
            rockGroup = new THREE.Group();
            particleGroup = new THREE.Group();
            
            scene.add(fishGroup);
            scene.add(coralGroup);
            scene.add(seaweedGroup);
            scene.add(rockGroup);
            scene.add(particleGroup);
            
            updateLoadProgress("Balƒ±k g√∂rselleri i≈üleniyor...", 70);
            
            // BALIK TEKST√úRLERƒ∞Nƒ∞ Y√úKLE
            await loadFishTextures();
            
            updateLoadProgress("√áevre objeleri olu≈üturuluyor...", 80);
            
            // √áEVRE OBJELERƒ∞
            createCorals(50);
            createSeaweed(100);
            createRocks(30);
            createParticles(200);
            
            // RASTGELE BALIKLAR
            createRandomFish(25);
            
            updateLoadProgress("Oyuncu balƒ±ƒüƒ± olu≈üturuluyor...", 90);
            
            // OYUNCU BALIƒûI
            createPlayerFish();
            
            updateLoadProgress("Oyun hazƒ±rlanƒ±yor...", 95);
        }

        // BALIK TEKST√úRLERƒ∞Nƒ∞ Y√úKLE
        async function loadFishTextures() {
            const textureLoader = new THREE.TextureLoader();
            
            for (let i = 0; i < FISH_TEXTURES.length; i++) {
                const fish = FISH_TEXTURES[i];
                
                try {
                    const texture = await new Promise((resolve, reject) => {
                        textureLoader.load(
                            fish.url,
                            resolve,
                            undefined,
                            () => {
                                // Fallback texture
                                const canvas = document.createElement('canvas');
                                canvas.width = 256;
                                canvas.height = 256;
                                const ctx = canvas.getContext('2d');
                                ctx.fillStyle = i % 2 === 0 ? '#3498db' : '#e74c3c';
                                ctx.fillRect(0, 0, 256, 256);
                                ctx.fillStyle = 'white';
                                ctx.font = '100px Arial';
                                ctx.fillText('üê†', 80, 160);
                                resolve(new THREE.CanvasTexture(canvas));
                            }
                        );
                    });
                    
                    texture.wrapS = THREE.RepeatWrapping;
                    texture.wrapT = THREE.RepeatWrapping;
                    fishTextures.push(texture);
                    
                } catch (error) {
                    console.error(`Texture ${i} y√ºkleme hatasƒ±:`, error);
                }
            }
        }

        // MERCANLAR OLU≈ûTUR
        function createCorals(count) {
            const coralColors = [0xff6b6b, 0xff9ff3, 0xfeca57, 0x48dbfb, 0x1dd1a1];
            
            for (let i = 0; i < count; i++) {
                const coralType = Math.floor(Math.random() * 3);
                let coral;
                
                if (coralType === 0) {
                    // K√º√ß√ºk mercan
                    coral = new THREE.Mesh(
                        new THREE.ConeGeometry(0.5, 2, 8),
                        new THREE.MeshLambertMaterial({ 
                            color: coralColors[Math.floor(Math.random() * coralColors.length)],
                            transparent: true,
                            opacity: 0.9
                        })
                    );
                } else if (coralType === 1) {
                    // B√ºy√ºk mercan
                    coral = new THREE.Mesh(
                        new THREE.SphereGeometry(1, 8, 6),
                        new THREE.MeshLambertMaterial({ 
                            color: coralColors[Math.floor(Math.random() * coralColors.length)],
                            transparent: true,
                            opacity: 0.8
                        })
                    );
                } else {
                    // Dal mercanƒ±
                    coral = new THREE.Mesh(
                        new THREE.CylinderGeometry(0.2, 0.5, 3, 6),
                        new THREE.MeshLambertMaterial({ 
                            color: coralColors[Math.floor(Math.random() * coralColors.length)],
                            transparent: true,
                            opacity: 0.9
                        })
                    );
                }
                
                coral.castShadow = true;
                coral.receiveShadow = true;
                coral.position.set(
                    (Math.random() - 0.5) * 900,
                    -45 + Math.random() * 5,
                    (Math.random() - 0.5) * 900
                );
                coral.rotation.y = Math.random() * Math.PI * 2;
                coral.scale.setScalar(0.5 + Math.random() * 1.5);
                
                coralGroup.add(coral);
            }
        }

        // DENƒ∞Z YOSUNU OLU≈ûTUR
        function createSeaweed(count) {
            const seaweedColors = [0x27ae60, 0x2ecc71, 0x1abc9c];
            
            for (let i = 0; i < count; i++) {
                const height = 1 + Math.random() * 4;
                const seaweed = new THREE.Mesh(
                    new THREE.ConeGeometry(0.1, height, 8),
                    new THREE.MeshLambertMaterial({ 
                        color: seaweedColors[Math.floor(Math.random() * seaweedColors.length)],
                        transparent: true,
                        opacity: 0.8
                    })
                );
                
                seaweed.position.set(
                    (Math.random() - 0.5) * 900,
                    -45,
                    (Math.random() - 0.5) * 900
                );
                seaweed.userData = {
                    initialHeight: height,
                    speed: 0.5 + Math.random() * 1,
                    offset: Math.random() * Math.PI * 2
                };
                
                seaweedGroup.add(seaweed);
            }
        }

        // KAYALIKLAR OLU≈ûTUR
        function createRocks(count) {
            for (let i = 0; i < count; i++) {
                const size = 1 + Math.random() * 3;
                const rock = new THREE.Mesh(
                    new THREE.DodecahedronGeometry(size, 1),
                    new THREE.MeshLambertMaterial({ 
                        color: 0x666666,
                        flatShading: true
                    })
                );
                
                rock.castShadow = true;
                rock.receiveShadow = true;
                rock.position.set(
                    (Math.random() - 0.5) * 900,
                    -45 + size / 2,
                    (Math.random() - 0.5) * 900
                );
                rock.rotation.set(
                    Math.random() * Math.PI,
                    Math.random() * Math.PI,
                    Math.random() * Math.PI
                );
                
                rockGroup.add(rock);
            }
        }

        // PAR√áACIKLAR OLU≈ûTUR (su partik√ºlleri)
        function createParticles(count) {
            const particleGeometry = new THREE.BufferGeometry();
            const positions = new Float32Array(count * 3);
            const colors = new Float32Array(count * 3);
            
            for (let i = 0; i < count; i++) {
                positions[i * 3] = (Math.random() - 0.5) * 1000;
                positions[i * 3 + 1] = Math.random() * 50 - 50;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 1000;
                
                // Mavi tonlarƒ±nda renkler
                colors[i * 3] = 0.2 + Math.random() * 0.3;     // R
                colors[i * 3 + 1] = 0.5 + Math.random() * 0.3; // G
                colors[i * 3 + 2] = 0.8 + Math.random() * 0.2; // B
            }
            
            particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            particleGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            
            const particleMaterial = new THREE.PointsMaterial({
                size: 0.5,
                vertexColors: true,
                transparent: true,
                opacity: 0.6
            });
            
            const particles = new THREE.Points(particleGeometry, particleMaterial);
            particleGroup.add(particles);
        }

        // RASTGELE BALIKLAR OLU≈ûTUR
        function createRandomFish(count) {
            for (let i = 0; i < count; i++) {
                const fishIndex = Math.floor(Math.random() * FISH_TEXTURES.length);
                const fishData = FISH_TEXTURES[fishIndex];
                
                if (!fishTextures[fishIndex]) continue;
                
                // Balƒ±k sprite'ƒ±
                const fishMaterial = new THREE.SpriteMaterial({ 
                    map: fishTextures[fishIndex],
                    transparent: true,
                    opacity: 0.9
                });
                
                const fish = new THREE.Sprite(fishMaterial);
                fish.scale.set(fishData.scale * 5, fishData.scale * 5, 1);
                
                // Pozisyon
                fish.position.set(
                    (Math.random() - 0.5) * 800,
                    Math.random() * 40 - 30,
                    (Math.random() - 0.5) * 800
                );
                
                // Rastgele hareket verileri
                fish.userData = {
                    speed: fishData.speed * (0.3 + Math.random() * 0.7),
                    direction: new THREE.Vector3(
                        Math.random() - 0.5,
                        Math.random() * 0.4 - 0.2,
                        Math.random() - 0.5
                    ).normalize(),
                    isRandom: true,
                    type: fishData.name,
                    turnSpeed: 0.02 + Math.random() * 0.03,
                    bobSpeed: 0.5 + Math.random() * 1,
                    bobOffset: Math.random() * Math.PI * 2
                };
                
                fishGroup.add(fish);
            }
        }

        // OYUNCU BALIƒûI OLU≈ûTUR
        function createPlayerFish() {
            const fishData = FISH_TEXTURES[selectedFishIndex];
            
            if (!fishTextures[selectedFishIndex]) return;
            
            const fishMaterial = new THREE.SpriteMaterial({ 
                map: fishTextures[selectedFishIndex],
                transparent: true,
                opacity: 1
            });
            
            playerFish = new THREE.Sprite(fishMaterial);
            playerFish.scale.set(fishData.scale * 8, fishData.scale * 8, 1);
            playerFish.position.set(0, 0, 0);
            
            playerFish.userData = {
                speed: fishData.speed,
                isPlayer: true,
                type: fishData.name,
                bobSpeed: 0.8,
                bobAmount: 0.5
            };
            
            scene.add(playerFish);
            controls.target.copy(playerFish.position);
        }

        // EVENT LISTENER'LAR
        function setupEventListeners() {
            // TIKLAMA
            renderer.domElement.addEventListener('click', onMouseClick);
            renderer.domElement.addEventListener('touchstart', onTouchStart);
            
            // FARE HAREKETƒ∞ (balƒ±k adƒ± g√∂sterimi)
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            
            // KLAVYE
            document.addEventListener('keydown', onKeyDown);
            
            // PENCERE BOYUTU
            window.addEventListener('resize', onWindowResize);
            
            // ESC
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') backToMenu();
            });
        }

        function onMouseClick(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            raycaster.setFromCamera(mouse, camera);
            
            // Okyanus zeminine tƒ±klama
            const plane = new THREE.Plane(new THREE.Vector3(0, 1, 0), 0);
            const targetPoint = new THREE.Vector3();
            raycaster.ray.intersectPlane(plane, targetPoint);
            
            targetPosition.copy(targetPoint);
            targetPosition.y = Math.max(-30, Math.min(15, targetPoint.y));
            isMoving = true;
        }

        function onTouchStart(event) {
            event.preventDefault();
            if (event.touches.length === 1) {
                mouse.x = (event.touches[0].clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(event.touches[0].clientY / window.innerHeight) * 2 + 1;
                
                raycaster.setFromCamera(mouse, camera);
                const plane = new THREE.Plane(new THREE.Vector3(0, 1, 0), 0);
                const targetPoint = new THREE.Vector3();
                raycaster.ray.intersectPlane(plane, targetPoint);
                
                targetPosition.copy(targetPoint);
                targetPosition.y = Math.max(-30, Math.min(15, targetPoint.y));
                isMoving = true;
            }
        }

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(fishGroup.children);
            
            if (intersects.length > 0) {
                const fish = intersects[0].object;
                fishNameTag.textContent = fish.userData.type || 'Balƒ±k';
                fishNameTag.style.display = 'block';
                fishNameTag.style.left = `${event.clientX + 10}px`;
                fishNameTag.style.top = `${event.clientY - 10}px`;
            } else {
                fishNameTag.style.display = 'none';
            }
        }

        function onKeyDown(event) {
            const moveSpeed = 10;
            const delta = clock.getDelta();
            
            switch(event.key.toLowerCase()) {
                case 'w':
                    camera.position.add(controls.target.clone().sub(camera.position).normalize().multiplyScalar(moveSpeed * delta));
                    break;
                case 's':
                    camera.position.sub(controls.target.clone().sub(camera.position).normalize().multiplyScalar(moveSpeed * delta));
                    break;
                case 'a':
                    camera.position.add(new THREE.Vector3().crossVectors(camera.up, controls.target.clone().sub(camera.position)).normalize().multiplyScalar(moveSpeed * delta));
                    break;
                case 'd':
                    camera.position.sub(new THREE.Vector3().crossVectors(camera.up, controls.target.clone().sub(camera.position)).normalize().multiplyScalar(moveSpeed * delta));
                    break;
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // ANƒ∞MASYON D√ñNG√úS√ú
        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();
            const delta = clock.getDelta();
            
            // SU ANƒ∞MASYONU
            if (waterUniforms) {
                waterUniforms['time'].value += delta * 0.5;
            }
            
            // KONTROLLER
            controls.update();
            
            // OYUNCU BALIƒûI HAREKETƒ∞
            if (playerFish && isMoving) {
                const direction = new THREE.Vector3()
                    .subVectors(targetPosition, playerFish.position)
                    .normalize();
                
                const distance = playerFish.position.distanceTo(targetPosition);
                
                if (distance > 1) {
                    const moveAmount = playerFish.userData.speed * delta * 5;
                    playerFish.position.add(direction.multiplyScalar(moveAmount));
                    
                    // Balƒ±k y√∂n√ºn√º hedefe √ßevir
                    const targetRotation = Math.atan2(direction.x, direction.z);
                    playerFish.rotation.y = targetRotation;
                    
                    // Derinlik g√ºncelleme
                    const depth = Math.abs(playerFish.position.y).toFixed(1);
                    currentDepth.textContent = `${depth}m`;
                    depthValue.textContent = `${depth}m`;
                    
                    // Kamera hedefini takip et
                    controls.target.lerp(playerFish.position, delta * 3);
                } else {
                    isMoving = false;
                }
            }
            
            // BALIK SALLANMA ANƒ∞MASYONU
            if (playerFish) {
                const bob = Math.sin(time * playerFish.userData.bobSpeed) * playerFish.userData.bobAmount;
                playerFish.position.y += bob * delta;
            }
            
            // RASTGELE BALIK HAREKETƒ∞
            fishGroup.children.forEach(fish => {
                if (fish.userData.isRandom) {
                    // ƒ∞leri hareket
                    fish.translateX(fish.userData.speed * delta);
                    
                    // Y√∂n deƒüi≈ütirme
                    if (Math.random() < 0.02) {
                        fish.userData.direction.set(
                            Math.random() - 0.5,
                            Math.random() * 0.4 - 0.2,
                            Math.random() - 0.5
                        ).normalize();
                    }
                    
                    // Sƒ±nƒ±r kontrol√º
                    if (Math.abs(fish.position.x) > 400 || Math.abs(fish.position.z) > 400) {
                        fish.userData.direction.x *= -1;
                        fish.userData.direction.z *= -1;
                    }
                    
                    if (fish.position.y < -40 || fish.position.y > 15) {
                        fish.userData.direction.y *= -1;
                    }
                    
                    // Yava≈ü d√∂n√º≈ü
                    const targetRotation = Math.atan2(fish.userData.direction.x, fish.userData.direction.z);
                    fish.rotation.y += (targetRotation - fish.rotation.y) * fish.userData.turnSpeed;
                    
                    // Sallanma animasyonu
                    const bob = Math.sin(time * fish.userData.bobSpeed + fish.userData.bobOffset) * 0.2;
                    fish.position.y += bob * delta;
                }
            });
            
            // DENƒ∞Z YOSUNU ANƒ∞MASYONU
            seaweedGroup.children.forEach(seaweed => {
                seaweed.rotation.z = Math.sin(time * seaweed.userData.speed + seaweed.userData.offset) * 0.3;
                seaweed.scale.y = 1 + Math.sin(time * seaweed.userData.speed + seaweed.userData.offset) * 0.2;
            });
            
            // PAR√áACIK HAREKETƒ∞
            particleGroup.children.forEach(particleSystem => {
                particleSystem.rotation.y += delta * 0.1;
            });
            
            // RENDER
            renderer.render(scene, camera);
        }

        // OYUNU BA≈ûLAT
        async function startGame() {
            console.log("üåä GER√áEK√áƒ∞ OKYANUS BA≈ûLATILIYOR...");
            
            // Ekranlarƒ± deƒüi≈ütir
            startScreen.style.display = 'none';
            gameScreen.style.display = 'block';
            
            // Y√ºkleme ekranƒ±nƒ± gizle
            setTimeout(() => {
                loadingScreen.style.opacity = '0';
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 500);
            }, 300);
            
            // Animasyonu ba≈ülat
            animate();
        }

        // MEN√úYE D√ñN
        function backToMenu() {
            gameScreen.style.display = 'none';
            startScreen.style.display = 'flex';
        }

        // BUTONLARI BA≈ûLAT
        function initializeButtons() {
            startButton.addEventListener('click', startGame);
            window.backToMenu = backToMenu;
        }

        // SAYFA Y√úKLENDƒ∞ƒûƒ∞NDE
        window.addEventListener('load', async function() {
            console.log("‚úÖ Sayfa y√ºklendi! Oyun hazƒ±rlanƒ±yor...");
            
            try {
                // Balƒ±k butonlarƒ±nƒ± olu≈ütur
                await createFishButtons();
                
                // Three.js sahnesini olu≈ütur
                await initThreeJS();
                
                // Event listener'larƒ± kur
                setupEventListeners();
                
                // Butonlarƒ± ba≈ülat
                initializeButtons();
                
                updateLoadProgress("Oyun hazƒ±r! Ba≈ülamak i√ßin tƒ±klayƒ±n...", 100);
                
                console.log("üéÆ Oyun hazƒ±r! 'DERƒ∞NLƒ∞KLERE DAL' butonuna tƒ±kla!");
                
            } catch (error) {
                console.error("Oyun y√ºkleme hatasƒ±:", error);
                loadText.textContent = "Y√ºkleme hatasƒ±! Sayfayƒ± yenileyin.";
            }
        });

        // HATA YAKALAMA
        window.addEventListener('error', function(e) {
            console.error('‚ùå Hata:', e.error);
        });
    </script>
</body>
</html>
